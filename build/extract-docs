#!/usr/bin/perl -W
# -*- cperl -*-
use strict;

my $doc = "";

my %doc = ();

while (<>) {
  if (m(/\*\*[^\@]) .. m(\*/)) {
    s(-\*-.*?-\*-) ();
    s(/?\*[\*/]?[ \t]*) ();
    s(^ *) ();
    s(`(Tootsville\..+)') (\@ref{$1})g;
    s(([^`])`([^`].*?)::?(.+)') ($1\@ref{$2 $3})g;
    s(([^`])`([^`].*?)') ($1\@ref{TOOTSVILLE $2})g;
    $doc .= $_
  } else {
    if (($doc ne "") && (m(^\s*((window|Tootsville)\..*?) *= *(.*))) ) {
      my $obj = $1; my $val = $3;
      my $iobj = $obj; $iobj =~ s/^Tootsville\.//;
      if ($val =~ m/function *(\(.*?\))/) {
        my $ll = $1;
        if ('()' eq $ll) {
          $doc{$obj} = "
\@page
\@node $obj
\@jsindex $iobj
\@section $obj
\@subsection Function

$obj is nullary function.

$doc\n\n";
        } else {
          $doc{$obj} = "
\@page
\@node $obj
\@jsindex $iobj
\@section $obj
\@subsection Function

$obj is a function with lambda list: $ll

$doc\n\n";
        }
      } else {
        $doc{$obj} = "
\@page
\@node $obj
\@section $obj
\@jsindex $iobj
\@subsection Variable

$doc\n\n";
      }
      $doc = "";
    }
  }
}

for my $key (sort keys %doc)
{ print $doc{$key} }


