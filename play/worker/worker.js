if(!TootsvilleWorker)var TootsvilleWorker={cluster:document.location.host.split(".").splice(1).join(".")};Tootsville.inform=function(a,b){console.info.apply(console,arguments);dataLayer.push({event:a,details:arguments});Rollbar.info(Array.prototype.splice.call(arguments).map(function(a){a.toSource()}).join("\t"))};Tootsville.warn=function(a){console.warn.apply(console,arguments);dataLayer.push({event:"warning",details:arguments});Rollbar.warn.apply(Rollbar,Array.prototype.splice.call(arguments).map(function(a){a.toSource()}).join("\t"))};
Tootsville.error=function(a){console.error.apply(console,arguments);dataLayer.push({event:"error",details:arguments});throw Error(a);};(function(){var a={silver:"#ddd",charcoal:"#333",white:"#fff",black:"#000","deep-purple":"#b117ff",yellow:"#ffff00",pink:"#e73e97",turquoise:"#00a290",periwinkle:"#96b4de",violet:"#9669ad",gold:"#f7d023",burgundy:"#9c0059",green:"#7ac142",blue:"#0082c8",lavender:"#ba9dca",tan:"#ffd2a0",red:"#e51b24","spring-green":"#c4d82d",indigo:"#0028ff",orange:"#ff7b26"};window.interpretTootColor=function(b){return a[b]}})();Tootsville.db={db:null,version:1,migrateTo:{},handleError:function(a){switch(a.target.errorCode){case VER_ERR:Tootsville.error("Database error","Database version is greater than "+Tootsville.db.version);break;default:Tootsville.warn("Database error",a),alert("Database error: "+a.target.toSource())}},upgradeNeeded:function(a){a=a.target.result;for(var b=0;b<Tootsville.db.version;++b)Tootsville.db.migrateTo[b].call(a,a)},open:function(){return Tootsville.db.db?new Promise(function(a){a(Tootsville.db.db)}):
new Promise(function(a){var b=window.indexedDB.open("Tootsville.Player",Tootsville.db.version);b.onsuccess=function(c){Tootsville.db.db=c.result.target;a(Tootsville.db.db)};b.onerror=Tootsville.db.handleError;b.onupgradeneeded=Tootsville.db.upgradeNeeded})},find:function(a,b,c){return new Promise(function(d){Tootsville.db.open().then(function(e){e=e.transaction([a]);e.oncomplete=function(a){d()};e.onerror=function(a){Tootsville.error(a)}})})},set:function(a,b){return new Promise(function(c){Tootsville.db.open().then(function(d){d=
d.transaction([a],"readwrite").objectStore(a).add(b);d.oncomplete=function(){};d.onerror=function(a){Tootsville.error(a)};d.onsuccess=function(a){c(b)}})})}};Tootsville.db.migrateTo[1]=function(a){return new Promise(function(b){var c=a.createObjectStore("Credentials",{keyPath:"service"});c.createIndex("service","service",{unique:!0});c.transaction.oncomplete=function(){var d=a.createObjectStore("Preferences",{keyPath:"pref"});d.createIndex("pref","pref",{unique:!0});d.transaction.oncomplete=function(){b(a)}}})};(function(){function a(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[];a("js",new Date);a("config","UA-80917352-1");a("set",{appVersion:"0.0.5"});Tootsville.charID&&a("set",{user_id:Tootsville.charID});"\uff1f"!=Tootsville.charName&&a("set",{charName:Tootsville.charName});console.log("Inititalized Google Tag Manager")})();ibgSdk.init({token:"a1f625a30b0071644267de171fe2bed6"});var _rollbarConfig={accessToken:"e487f4cbf55b40318c89aa3a14d9e4da",captureUncaught:!0,verbose:!0,captureUnhandledRejections:!0,autoInstrument:{network:!0,log:!0,dom:!0,navigation:!0,connectivity:!0},payload:{environment:document.location.host.split(".").splice(1)}};
!function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){a=c(1);b=c(4);_rollbarConfig=_rollbarConfig||{};_rollbarConfig.rollbarJsUrl=_rollbarConfig.rollbarJsUrl||"https://cdnjs.cloudflare.com/ajax/libs/rollbar.js/2.3.8/rollbar.min.js";_rollbarConfig.async=void 0===_rollbarConfig.async||_rollbarConfig.async;c=a.setupShim(window,_rollbarConfig);
b=b(_rollbarConfig);window.rollbar=a.Rollbar;c.loadFull(window,document,!_rollbarConfig.async,_rollbarConfig,b)},function(a,b,c){function d(a){return function(){try{return a.apply(this,arguments)}catch(d){try{console.error("[Rollbar]: Internal error",d)}catch(e){}}}}function e(a,d){this.options=a;this._rollbarOldOnError=null;var e=g++;this.shimId=function(){return e};"undefined"!=typeof window&&window._rollbarShims&&(window._rollbarShims[e]={handler:d,messages:[]})}function k(a){return d(function(){var d=
Array.prototype.slice.call(arguments,0),d={shim:this,method:a,args:d,ts:new Date};window._rollbarShims[this.shimId()].messages.push(d)})}var h=c(2),g=0,f=c(3).bind(null,function(a,d){return new e(a,d)});e.prototype.loadFull=function(a,e,c,b,h){var g=!1,f=e.createElement("script");e=e.getElementsByTagName("script")[0];var k=e.parentNode;f.crossOrigin="";f.src=b.rollbarJsUrl;c||(f.async=!0);f.onload=f.onreadystatechange=d(function(){if(!(g||this.readyState&&"loaded"!==this.readyState&&"complete"!==
this.readyState)){f.onload=f.onreadystatechange=null;try{k.removeChild(f)}catch(d){}g=!0;var e;if(void 0===a._rollbarDidLoad){e=Error("rollbar.js did not load");for(var c,b,m,l=0;c=a._rollbarShims[l++];)for(c=c.messages||[];b=c.shift();)for(b=b.args||[],l=0;l<b.length;++l)if(m=b[l],"function"==typeof m){m(e);break}}"function"==typeof h&&h(e)}});k.insertBefore(f,e)};e.prototype.wrap=function(a,d,e){try{var c;if((c="function"==typeof d?d:function(){return d||{}},"function"!=typeof a)||a._isWrap)return a;
if(!a._rollbar_wrapped&&(a._rollbar_wrapped=function(){e&&"function"==typeof e&&e.apply(this,arguments);try{return a.apply(this,arguments)}catch(d){var b=d;throw"string"==typeof b&&(b=new String(b)),b._rollbarContext=c()||{},b._rollbarContext._wrappedSource=a.toString(),window._rollbarWrappedError=b,b;}},a._rollbar_wrapped._isWrap=!0,a.hasOwnProperty))for(var b in a)a.hasOwnProperty(b)&&(a._rollbar_wrapped[b]=a[b]);return a._rollbar_wrapped}catch(f){return a}};b="log debug info warn warning error critical global configure handleUncaughtException handleUnhandledRejection captureEvent captureDomContentLoaded captureLoad".split(" ");
for(c=0;c<b.length;++c)e.prototype[b[c]]=k(b[c]);a.exports={setupShim:function(a,e){if(a){var b=e.globalAlias||"Rollbar";if("object"==typeof a[b])return a[b];a._rollbarShims={};a._rollbarWrappedError=null;var c=new f(e);return d(function(){e.captureUncaught&&(c._rollbarOldOnError=a.onerror,h.captureUncaughtExceptions(a,c,!0),h.wrapGlobals(a,c,!0));e.captureUnhandledRejections&&h.captureUnhandledRejections(a,c,!0);var d=e.autoInstrument;return!1!==e.enabled&&(void 0===d||!0===d||"object"==typeof d&&
d.network)&&a.addEventListener&&(a.addEventListener("load",c.captureLoad.bind(c)),a.addEventListener("DOMContentLoaded",c.captureDomContentLoaded.bind(c))),a[b]=c,c})()}},Rollbar:f}},function(a,b){function c(a,e,b){if(e.hasOwnProperty&&e.hasOwnProperty("addEventListener")){for(var c=e.addEventListener;c._rollbarOldAdd&&c.belongsToShim;)c=c._rollbarOldAdd;var g=function(e,b,f){c.call(this,e,a.wrap(b),f)};g._rollbarOldAdd=c;g.belongsToShim=b;e.addEventListener=g;for(var f=e.removeEventListener;f._rollbarOldRemove&&
f.belongsToShim;)f=f._rollbarOldRemove;g=function(a,d,e){f.call(this,a,d&&d._rollbar_wrapped||d,e)};g._rollbarOldRemove=f;g.belongsToShim=b;e.removeEventListener=g}}a.exports={captureUncaughtExceptions:function(a,e,c){if(a){var b;"function"==typeof e._rollbarOldOnError?b=e._rollbarOldOnError:a.onerror&&!a.onerror.belongsToShim&&(b=a.onerror,e._rollbarOldOnError=b);var g=function(){var c=Array.prototype.slice.call(arguments,0),g=b;a._rollbarWrappedError&&(c[4]||(c[4]=a._rollbarWrappedError),c[5]||
(c[5]=a._rollbarWrappedError._rollbarContext),a._rollbarWrappedError=null);e.handleUncaughtException.apply(e,c);g&&g.apply(a,c)};g.belongsToShim=c;a.onerror=g}},captureUnhandledRejections:function(a,c,b){if(a){"function"==typeof a._rollbarURH&&a._rollbarURH.belongsToShim&&a.removeEventListener("unhandledrejection",a._rollbarURH);var h=function(a){var b,d,h;try{b=a.reason}catch(k){b=void 0}try{d=a.promise}catch(k){d="[unhandledrejection] error getting `promise` from event"}try{h=a.detail,!b&&h&&(b=
h.reason,d=h.promise)}catch(k){}b||(b="[unhandledrejection] error getting `reason` from event");c&&c.handleUnhandledRejection&&c.handleUnhandledRejection(b,d)};h.belongsToShim=b;a._rollbarURH=h;a.addEventListener("unhandledrejection",h)}},wrapGlobals:function(a,b,k){if(a){var h,g,f="EventTarget Window Node ApplicationCache AudioTrackList ChannelMergerNode CryptoOperation EventSource FileReader HTMLUnknownElement IDBDatabase IDBRequest IDBTransaction KeyOperation MediaController MessagePort ModalWindow Notification SVGElementInstance Screen TextTrack TextTrackCue TextTrackList WebSocket WebSocketWorker Worker XMLHttpRequest XMLHttpRequestEventTarget XMLHttpRequestUpload".split(" ");
for(h=0;h<f.length;++h)g=f[h],a[g]&&a[g].prototype&&c(b,a[g].prototype,k)}}}},function(a,b){function c(a,b){this.impl=a(b,this);this.options=b;d(c.prototype)}function d(a){for(var b=function(a){return function(){var b=Array.prototype.slice.call(arguments,0);if(this.impl[a])return this.impl[a].apply(this.impl,b)}},c="log debug info warn warning error critical global configure handleUncaughtException handleUnhandledRejection _createItem wrap loadFull shimId captureEvent captureDomContentLoaded captureLoad".split(" "),
d=0;d<c.length;d++)a[c[d]]=b(c[d])}c.prototype._swapAndProcessMessages=function(a,b){this.impl=a(this.options);for(var c,d,f;c=b.shift();)d=c.method,f=c.args,this[d]&&"function"==typeof this[d]&&("captureDomContentLoaded"===d||"captureLoad"===d?this[d].apply(this,[f[0],c.ts]):this[d].apply(this,f));return this};a.exports=c},function(a,b){a.exports=function(a){return function(b){if(!b&&!window._rollbarInitialized){a=a||{};for(var e,k=a.globalAlias||"Rollbar",h=window.rollbar,g=function(a){return new h(a)},
f=0;b=window._rollbarShims[f++];)e||(e=b.handler),b.handler._swapAndProcessMessages(g,b.messages);window[k]=e;window._rollbarInitialized=!0}}}}]);console.log("Initialized Rollbar");Tootsville.util||(Tootsville.util={});Tootsville.util.postJSONforJSON=function(a,b,c){b||(b={});c||(c={});return new Promise(function(d,e){var k=new XmlHttpRequest;k.open("POST",a);k.onload=function(a){d(JSON.parse(a.body))};k.onerror=function(a){e(a)};for(header in c)c.hasOwnProperty(header)&&k.setRequestHeader(header,c[header]);k.setRequestHeader("Accept","application/json;encoding=utf-8");k.setRequestHeader("Content-Type","application/json;encoding=utf-8");k.send(JSON.strigify(b))})};
Tootsville.util.assertValidHost=function(a){return-1<["users","gossip","indira"].indexOf(a)};Tootsville.util.rest=function(a,b,c){var d=a.split("/")[1];Tootsville.util.assertValidHostName(d);return Tootsville.util.postJSONforJSON("https://"+d+"."+Tootsville.cluster+a,b,c)};Tootsville.registerServiceWorkner=function(){"serviceWorker"in navigator?window.addEventListener("load",function(){navigator.serviceWorker.register("./worker.js").then(function(a){Tootsville.inform("ServiceWorker registration successful with scope: ",a.scope)},function(a){Tootsville.error("ServiceWorker registration failed: ",a)})}):(alert("Can not register ServiceWorker.\nThis is a required feature to play the game."),document.location="https://wikiwiki.tootsville.adventuring.click/wikiwiki/Can_not_register_ServiceWorker")};
//# sourceMappingURL=/worker/worker.map
