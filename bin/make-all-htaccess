#!/bin/sh

mkdir -p "$(dirname $0)"/../dist/htaccess.all/
rm -fr "$(dirname $0)"/../dist/htaccess.all/*
cd "$(dirname $0)"/../dist/htaccess.all/
    for cluster in tootsville.org tootsville.ga ; do
        echo '{' >> $cluster.cluster.json
        for host in play gossip world users ; do
            sed ../../htaccess.base -e s/@@HOST@@/$host/g \
                -e s/@@CLUSTER@@/$cluster/g \
                | grep -v 'RedirectMatch ^/[a-z].* https://'$host'.' \
                       > $host.$cluster.htaccess
            echo "\"$host\": \"$host.$cluster\"," >> $cluster.cluster.json
        done
    done
    echo '"productionP":true,"testP":false}' >> tootsville.org.cluster.json
    echo '"productionP":false,"testP":true}' >> tootsville.ga.cluster.json

